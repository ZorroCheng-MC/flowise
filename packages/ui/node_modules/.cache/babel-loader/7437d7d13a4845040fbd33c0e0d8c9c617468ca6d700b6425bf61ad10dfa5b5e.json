{"ast":null,"code":"import _defineProperty from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useState}from'react';import{FormControl,Popover}from'@mui/material';import ReactJson from'flowise-react-json-view';import SelectVariable from'./SelectVariable';import{cloneDeep}from'lodash';import{getAvailableNodesForVariable}from'utils/genericHelper';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var JsonEditorInput=function JsonEditorInput(_ref){var value=_ref.value,onChange=_ref.onChange,inputParam=_ref.inputParam,nodes=_ref.nodes,edges=_ref.edges,nodeId=_ref.nodeId,_ref$disabled=_ref.disabled,disabled=_ref$disabled===void 0?false:_ref$disabled,_ref$isDarkMode=_ref.isDarkMode,isDarkMode=_ref$isDarkMode===void 0?false:_ref$isDarkMode;var _useState=useState(value?JSON.parse(value):{}),_useState2=_slicedToArray(_useState,2),myValue=_useState2[0],setMyValue=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),availableNodesForVariable=_useState4[0],setAvailableNodesForVariable=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),mouseUpKey=_useState6[0],setMouseUpKey=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),anchorEl=_useState8[0],setAnchorEl=_useState8[1];var openPopOver=Boolean(anchorEl);var handleClosePopOver=function handleClosePopOver(){setAnchorEl(null);};var setNewVal=function setNewVal(val){var newVal=cloneDeep(myValue);newVal[mouseUpKey]=val;onChange(JSON.stringify(newVal));setMyValue(function(params){return _objectSpread(_objectSpread({},params),{},_defineProperty({},mouseUpKey,val));});};var onClipboardCopy=function onClipboardCopy(e){var src=e.src;if(Array.isArray(src)||typeof src==='object'){navigator.clipboard.writeText(JSON.stringify(src,null,'  '));}else{navigator.clipboard.writeText(src);}};useEffect(function(){if(!disabled&&nodes&&edges&&nodeId&&inputParam){var nodesForVariable=inputParam!==null&&inputParam!==void 0&&inputParam.acceptVariable?getAvailableNodesForVariable(nodes,edges,nodeId,inputParam.id):[];setAvailableNodesForVariable(nodesForVariable);}},[disabled,inputParam,nodes,edges,nodeId]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(FormControl,{sx:{mt:1,width:'100%'},size:\"small\",children:[disabled&&/*#__PURE__*/_jsx(ReactJson,{theme:isDarkMode?'ocean':'rjv-default',style:{padding:10,borderRadius:10},src:myValue,name:null,enableClipboard:function enableClipboard(e){return onClipboardCopy(e);},quotesOnKeys:false,displayDataTypes:false}),!disabled&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(ReactJson,{theme:isDarkMode?'ocean':'rjv-default',style:{padding:10,borderRadius:10},src:myValue,name:null,quotesOnKeys:false,displayDataTypes:false,enableClipboard:function enableClipboard(e){return onClipboardCopy(e);},onMouseUp:function onMouseUp(event){if(inputParam!==null&&inputParam!==void 0&&inputParam.acceptVariable){setMouseUpKey(event.name);setAnchorEl(event.currentTarget);}},onEdit:function onEdit(edit){setMyValue(edit.updated_src);onChange(JSON.stringify(edit.updated_src));},onAdd:function onAdd(){//console.log(add)\n},onDelete:function onDelete(deleteobj){setMyValue(deleteobj.updated_src);onChange(JSON.stringify(deleteobj.updated_src));}})},JSON.stringify(myValue))]}),(inputParam===null||inputParam===void 0?void 0:inputParam.acceptVariable)&&/*#__PURE__*/_jsx(Popover,{open:openPopOver,anchorEl:anchorEl,onClose:handleClosePopOver,anchorOrigin:{vertical:'bottom',horizontal:'left'},transformOrigin:{vertical:'top',horizontal:'left'},children:/*#__PURE__*/_jsx(SelectVariable,{disabled:disabled,availableNodesForVariable:availableNodesForVariable,onSelectAndReturnVal:function onSelectAndReturnVal(val){setNewVal(val);handleClosePopOver();}})})]});};","map":{"version":3,"names":["useEffect","useState","FormControl","Popover","ReactJson","SelectVariable","cloneDeep","getAvailableNodesForVariable","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","JsonEditorInput","_ref","value","onChange","inputParam","nodes","edges","nodeId","_ref$disabled","disabled","_ref$isDarkMode","isDarkMode","_useState","JSON","parse","_useState2","_slicedToArray","myValue","setMyValue","_useState3","_useState4","availableNodesForVariable","setAvailableNodesForVariable","_useState5","_useState6","mouseUpKey","setMouseUpKey","_useState7","_useState8","anchorEl","setAnchorEl","openPopOver","Boolean","handleClosePopOver","setNewVal","val","newVal","stringify","params","_objectSpread","_defineProperty","onClipboardCopy","e","src","Array","isArray","navigator","clipboard","writeText","nodesForVariable","acceptVariable","id","children","sx","mt","width","size","theme","style","padding","borderRadius","name","enableClipboard","quotesOnKeys","displayDataTypes","onMouseUp","event","currentTarget","onEdit","edit","updated_src","onAdd","onDelete","deleteobj","open","onClose","anchorOrigin","vertical","horizontal","transformOrigin","onSelectAndReturnVal"],"sources":["/Users/zorro/Downloads/Flowise/packages/ui/src/ui-component/json/JsonEditor.js"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { FormControl, Popover } from '@mui/material'\nimport ReactJson from 'flowise-react-json-view'\nimport SelectVariable from './SelectVariable'\nimport { cloneDeep } from 'lodash'\nimport { getAvailableNodesForVariable } from 'utils/genericHelper'\n\nexport const JsonEditorInput = ({ value, onChange, inputParam, nodes, edges, nodeId, disabled = false, isDarkMode = false }) => {\n    const [myValue, setMyValue] = useState(value ? JSON.parse(value) : {})\n    const [availableNodesForVariable, setAvailableNodesForVariable] = useState([])\n    const [mouseUpKey, setMouseUpKey] = useState('')\n\n    const [anchorEl, setAnchorEl] = useState(null)\n    const openPopOver = Boolean(anchorEl)\n\n    const handleClosePopOver = () => {\n        setAnchorEl(null)\n    }\n\n    const setNewVal = (val) => {\n        const newVal = cloneDeep(myValue)\n        newVal[mouseUpKey] = val\n        onChange(JSON.stringify(newVal))\n        setMyValue((params) => ({\n            ...params,\n            [mouseUpKey]: val\n        }))\n    }\n\n    const onClipboardCopy = (e) => {\n        const src = e.src\n        if (Array.isArray(src) || typeof src === 'object') {\n            navigator.clipboard.writeText(JSON.stringify(src, null, '  '))\n        } else {\n            navigator.clipboard.writeText(src)\n        }\n    }\n\n    useEffect(() => {\n        if (!disabled && nodes && edges && nodeId && inputParam) {\n            const nodesForVariable = inputParam?.acceptVariable ? getAvailableNodesForVariable(nodes, edges, nodeId, inputParam.id) : []\n            setAvailableNodesForVariable(nodesForVariable)\n        }\n    }, [disabled, inputParam, nodes, edges, nodeId])\n\n    return (\n        <>\n            <FormControl sx={{ mt: 1, width: '100%' }} size='small'>\n                {disabled && (\n                    <ReactJson\n                        theme={isDarkMode ? 'ocean' : 'rjv-default'}\n                        style={{ padding: 10, borderRadius: 10 }}\n                        src={myValue}\n                        name={null}\n                        enableClipboard={(e) => onClipboardCopy(e)}\n                        quotesOnKeys={false}\n                        displayDataTypes={false}\n                    />\n                )}\n                {!disabled && (\n                    <div key={JSON.stringify(myValue)}>\n                        <ReactJson\n                            theme={isDarkMode ? 'ocean' : 'rjv-default'}\n                            style={{ padding: 10, borderRadius: 10 }}\n                            src={myValue}\n                            name={null}\n                            quotesOnKeys={false}\n                            displayDataTypes={false}\n                            enableClipboard={(e) => onClipboardCopy(e)}\n                            onMouseUp={(event) => {\n                                if (inputParam?.acceptVariable) {\n                                    setMouseUpKey(event.name)\n                                    setAnchorEl(event.currentTarget)\n                                }\n                            }}\n                            onEdit={(edit) => {\n                                setMyValue(edit.updated_src)\n                                onChange(JSON.stringify(edit.updated_src))\n                            }}\n                            onAdd={() => {\n                                //console.log(add)\n                            }}\n                            onDelete={(deleteobj) => {\n                                setMyValue(deleteobj.updated_src)\n                                onChange(JSON.stringify(deleteobj.updated_src))\n                            }}\n                        />\n                    </div>\n                )}\n            </FormControl>\n            {inputParam?.acceptVariable && (\n                <Popover\n                    open={openPopOver}\n                    anchorEl={anchorEl}\n                    onClose={handleClosePopOver}\n                    anchorOrigin={{\n                        vertical: 'bottom',\n                        horizontal: 'left'\n                    }}\n                    transformOrigin={{\n                        vertical: 'top',\n                        horizontal: 'left'\n                    }}\n                >\n                    <SelectVariable\n                        disabled={disabled}\n                        availableNodesForVariable={availableNodesForVariable}\n                        onSelectAndReturnVal={(val) => {\n                            setNewVal(val)\n                            handleClosePopOver()\n                        }}\n                    />\n                </Popover>\n            )}\n        </>\n    )\n}\n\nJsonEditorInput.propTypes = {\n    value: PropTypes.string,\n    onChange: PropTypes.func,\n    disabled: PropTypes.bool,\n    isDarkMode: PropTypes.bool,\n    inputParam: PropTypes.object,\n    nodes: PropTypes.array,\n    edges: PropTypes.array,\n    nodeId: PropTypes.string\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}