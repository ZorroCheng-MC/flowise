{"ast":null,"code":"import _objectSpread from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _createForOfIteratorHelper from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";import _toConsumableArray from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/zorro/Downloads/Flowise/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"inline\",\"className\",\"children\"];import{useState,useRef,useEffect,useCallback}from'react';import{useSelector}from'react-redux';import socketIOClient from'socket.io-client';import{cloneDeep}from'lodash';import rehypeMathjax from'rehype-mathjax';import remarkGfm from'remark-gfm';import remarkMath from'remark-math';import{CircularProgress,OutlinedInput,Divider,InputAdornment,IconButton,Box,Chip}from'@mui/material';import{useTheme}from'@mui/material/styles';import{IconSend}from'@tabler/icons';// project import\nimport{CodeBlock}from'ui-component/markdown/CodeBlock';import{MemoizedReactMarkdown}from'ui-component/markdown/MemoizedReactMarkdown';import SourceDocDialog from'ui-component/dialog/SourceDocDialog';import'./ChatMessage.css';// api\nimport chatmessageApi from'api/chatmessage';import chatflowsApi from'api/chatflows';import predictionApi from'api/prediction';// Hooks\nimport useApi from'hooks/useApi';// Const\nimport{baseURL,maxScroll}from'store/constant';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var ChatMessage=function ChatMessage(_ref){var open=_ref.open,chatflowid=_ref.chatflowid,isDialog=_ref.isDialog;var theme=useTheme();var customization=useSelector(function(state){return state.customization;});var ps=useRef();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),userInput=_useState2[0],setUserInput=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState([{message:'Hi there! How can I help?',type:'apiMessage'}]),_useState6=_slicedToArray(_useState5,2),messages=_useState6[0],setMessages=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),socketIOClientId=_useState8[0],setSocketIOClientId=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isChatFlowAvailableToStream=_useState10[0],setIsChatFlowAvailableToStream=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),sourceDialogOpen=_useState12[0],setSourceDialogOpen=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),sourceDialogProps=_useState14[0],setSourceDialogProps=_useState14[1];var inputRef=useRef(null);var getChatmessageApi=useApi(chatmessageApi.getChatmessageFromChatflow);var getIsChatflowStreamingApi=useApi(chatflowsApi.getIsChatflowStreaming);var onSourceDialogClick=function onSourceDialogClick(data){setSourceDialogProps({data:data});setSourceDialogOpen(true);};var scrollToBottom=function scrollToBottom(){if(ps.current){ps.current.scrollTo({top:maxScroll});}};var onChange=useCallback(function(e){return setUserInput(e.target.value);},[setUserInput]);var addChatMessage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(message,type,sourceDocuments){var newChatMessageBody;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;newChatMessageBody={role:type,content:message,chatflowid:chatflowid};if(sourceDocuments)newChatMessageBody.sourceDocuments=JSON.stringify(sourceDocuments);_context.next=5;return chatmessageApi.createNewChatmessage(chatflowid,newChatMessageBody);case 5:_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 10:case\"end\":return _context.stop();}},_callee,null,[[0,7]]);}));return function addChatMessage(_x,_x2,_x3){return _ref2.apply(this,arguments);};}();var updateLastMessage=function updateLastMessage(text){setMessages(function(prevMessages){var allMessages=_toConsumableArray(cloneDeep(prevMessages));if(allMessages[allMessages.length-1].type==='userMessage')return allMessages;allMessages[allMessages.length-1].message+=text;return allMessages;});};var updateLastMessageSourceDocuments=function updateLastMessageSourceDocuments(sourceDocuments){setMessages(function(prevMessages){var allMessages=_toConsumableArray(cloneDeep(prevMessages));if(allMessages[allMessages.length-1].type==='userMessage')return allMessages;allMessages[allMessages.length-1].sourceDocuments=sourceDocuments;return allMessages;});};// Handle errors\nvar handleError=function handleError(){var message=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'Oops! There seems to be an error. Please try again.';message=message.replace(\"Unable to parse JSON response from chat agent.\\n\\n\",'');setMessages(function(prevMessages){return[].concat(_toConsumableArray(prevMessages),[{message:message,type:'apiMessage'}]);});addChatMessage(message,'apiMessage');setLoading(false);setUserInput('');setTimeout(function(){var _inputRef$current;(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();},100);};// Handle form submission\nvar handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var params,response,data,errorData;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:e.preventDefault();if(!(userInput.trim()==='')){_context2.next=3;break;}return _context2.abrupt(\"return\");case 3:setLoading(true);setMessages(function(prevMessages){return[].concat(_toConsumableArray(prevMessages),[{message:userInput,type:'userMessage'}]);});// waiting for first chatmessage saved, the first chatmessage will be used in sendMessageAndGetPrediction\n_context2.next=7;return addChatMessage(userInput,'userMessage');case 7:_context2.prev=7;params={question:userInput,history:messages.filter(function(msg){return msg.message!=='Hi there! How can I help?';})};if(isChatFlowAvailableToStream)params.socketIOClientId=socketIOClientId;_context2.next=12;return predictionApi.sendMessageAndGetPrediction(chatflowid,params);case 12:response=_context2.sent;if(response.data){data=response.data;if(typeof data==='object'&&data.text&&data.sourceDocuments){if(!isChatFlowAvailableToStream){setMessages(function(prevMessages){return[].concat(_toConsumableArray(prevMessages),[{message:data.text,sourceDocuments:data.sourceDocuments,type:'apiMessage'}]);});}addChatMessage(data.text,'apiMessage',data.sourceDocuments);}else{if(!isChatFlowAvailableToStream){setMessages(function(prevMessages){return[].concat(_toConsumableArray(prevMessages),[{message:data,type:'apiMessage'}]);});}addChatMessage(data,'apiMessage');}setLoading(false);setUserInput('');setTimeout(function(){var _inputRef$current2;(_inputRef$current2=inputRef.current)===null||_inputRef$current2===void 0?void 0:_inputRef$current2.focus();scrollToBottom();},100);}_context2.next=21;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](7);errorData=_context2.t0.response.data||\"\".concat(_context2.t0.response.status,\": \").concat(_context2.t0.response.statusText);handleError(errorData);return _context2.abrupt(\"return\");case 21:case\"end\":return _context2.stop();}},_callee2,null,[[7,16]]);}));return function handleSubmit(_x4){return _ref3.apply(this,arguments);};}();// Prevent blank submissions and allow for multiline input\nvar handleEnter=function handleEnter(e){// Check if IME composition is in progress\nvar isIMEComposition=e.isComposing||e.keyCode===229;if(e.key==='Enter'&&userInput&&!isIMEComposition){if(!e.shiftKey&&userInput){handleSubmit(e);}}else if(e.key==='Enter'){e.preventDefault();}};// Get chatmessages successful\nuseEffect(function(){if(getChatmessageApi.data){var loadedMessages=[];var _iterator=_createForOfIteratorHelper(getChatmessageApi.data),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var message=_step.value;var obj={message:message.content,type:message.role};if(message.sourceDocuments)obj.sourceDocuments=JSON.parse(message.sourceDocuments);loadedMessages.push(obj);}}catch(err){_iterator.e(err);}finally{_iterator.f();}setMessages(function(prevMessages){return[].concat(_toConsumableArray(prevMessages),loadedMessages);});}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[getChatmessageApi.data]);// Get chatflow streaming capability\nuseEffect(function(){if(getIsChatflowStreamingApi.data){var _getIsChatflowStreami,_getIsChatflowStreami2;setIsChatFlowAvailableToStream((_getIsChatflowStreami=(_getIsChatflowStreami2=getIsChatflowStreamingApi.data)===null||_getIsChatflowStreami2===void 0?void 0:_getIsChatflowStreami2.isStreaming)!==null&&_getIsChatflowStreami!==void 0?_getIsChatflowStreami:false);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[getIsChatflowStreamingApi.data]);// Auto scroll chat to bottom\nuseEffect(function(){scrollToBottom();},[messages]);useEffect(function(){if(isDialog&&inputRef){setTimeout(function(){var _inputRef$current3;(_inputRef$current3=inputRef.current)===null||_inputRef$current3===void 0?void 0:_inputRef$current3.focus();},100);}},[isDialog,inputRef]);useEffect(function(){var socket;if(open&&chatflowid){getChatmessageApi.request(chatflowid);getIsChatflowStreamingApi.request(chatflowid);scrollToBottom();socket=socketIOClient(baseURL);socket.on('connect',function(){setSocketIOClientId(socket.id);});socket.on('start',function(){setMessages(function(prevMessages){return[].concat(_toConsumableArray(prevMessages),[{message:'',type:'apiMessage'}]);});});socket.on('sourceDocuments',updateLastMessageSourceDocuments);socket.on('token',updateLastMessage);}return function(){setUserInput('');setLoading(false);setMessages([{message:'Hi there! How can I help?',type:'apiMessage'}]);if(socket){socket.disconnect();setSocketIOClientId('');}};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[open,chatflowid]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:isDialog?'cloud-dialog':'cloud',children:/*#__PURE__*/_jsx(\"div\",{ref:ps,className:\"messagelist\",children:messages&&messages.map(function(message,index){return/*#__PURE__*/ (// The latest message sent by the user will be animated while waiting for a response\n_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(Box,{sx:{background:message.type==='apiMessage'?theme.palette.asyncSelect.main:''},style:{display:'flex'},className:message.type==='userMessage'&&loading&&index===messages.length-1?customization.isDarkMode?'usermessagewaiting-dark':'usermessagewaiting-light':message.type==='usermessagewaiting'?'apimessage':'usermessage',children:[message.type==='apiMessage'?/*#__PURE__*/_jsx(\"img\",{src:\"https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png\",alt:\"AI\",width:\"30\",height:\"30\",className:\"boticon\"}):/*#__PURE__*/_jsx(\"img\",{src:\"https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png\",alt:\"Me\",width:\"30\",height:\"30\",className:\"usericon\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"markdownanswer\",children:/*#__PURE__*/_jsx(MemoizedReactMarkdown,{remarkPlugins:[remarkGfm,remarkMath],rehypePlugins:[rehypeMathjax],components:{code:function code(_ref4){var inline=_ref4.inline,className=_ref4.className,children=_ref4.children,props=_objectWithoutProperties(_ref4,_excluded);var match=/language-(\\w+)/.exec(className||'');return!inline?/*#__PURE__*/_jsx(CodeBlock,_objectSpread({chatflowid:chatflowid,isDialog:isDialog,language:match&&match[1]||'',value:String(children).replace(/\\n$/,'')},props),Math.random()):/*#__PURE__*/_jsx(\"code\",_objectSpread(_objectSpread({className:className},props),{},{children:children}));}},children:message.message})}),message.sourceDocuments&&/*#__PURE__*/_jsx(\"div\",{style:{display:'block',flexDirection:'row',width:'100%'},children:message.sourceDocuments.map(function(source,index){return/*#__PURE__*/_jsx(Chip,{size:\"small\",label:\"\".concat(source.pageContent.substring(0,15),\"...\"),component:\"a\",sx:{mr:1,mb:1},variant:\"outlined\",clickable:true,onClick:function onClick(){return onSourceDialogClick(source);}},index);})})]})]},index)}));})})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(\"div\",{className:\"center\",children:/*#__PURE__*/_jsx(\"div\",{style:{width:'100%'},children:/*#__PURE__*/_jsx(\"form\",{style:{width:'100%'},onSubmit:handleSubmit,children:/*#__PURE__*/_jsx(OutlinedInput,{inputRef:inputRef// eslint-disable-next-line\n,autoFocus:true,sx:{width:'100%'},disabled:loading||!chatflowid,onKeyDown:handleEnter,id:\"userInput\",name:\"userInput\",placeholder:loading?'Waiting for response...':'Type your question...',value:userInput,onChange:onChange,multiline:true,maxRows:isDialog?7:2,endAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"end\",sx:{padding:'15px'},children:/*#__PURE__*/_jsx(IconButton,{type:\"submit\",disabled:loading||!chatflowid,edge:\"end\",children:loading?/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(CircularProgress,{color:\"inherit\",size:20})}):/*#__PURE__*/ // Send icon SVG in input field\n_jsx(IconSend,{color:loading||!chatflowid?'#9e9e9e':customization.isDarkMode?'white':'#1e88e5'})})})})})})}),/*#__PURE__*/_jsx(SourceDocDialog,{show:sourceDialogOpen,dialogProps:sourceDialogProps,onCancel:function onCancel(){return setSourceDialogOpen(false);}})]});};","map":{"version":3,"names":["useState","useRef","useEffect","useCallback","useSelector","socketIOClient","cloneDeep","rehypeMathjax","remarkGfm","remarkMath","CircularProgress","OutlinedInput","Divider","InputAdornment","IconButton","Box","Chip","useTheme","IconSend","CodeBlock","MemoizedReactMarkdown","SourceDocDialog","chatmessageApi","chatflowsApi","predictionApi","useApi","baseURL","maxScroll","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","ChatMessage","_ref","open","chatflowid","isDialog","theme","customization","state","ps","_useState","_useState2","_slicedToArray","userInput","setUserInput","_useState3","_useState4","loading","setLoading","_useState5","message","type","_useState6","messages","setMessages","_useState7","_useState8","socketIOClientId","setSocketIOClientId","_useState9","_useState10","isChatFlowAvailableToStream","setIsChatFlowAvailableToStream","_useState11","_useState12","sourceDialogOpen","setSourceDialogOpen","_useState13","_useState14","sourceDialogProps","setSourceDialogProps","inputRef","getChatmessageApi","getChatmessageFromChatflow","getIsChatflowStreamingApi","getIsChatflowStreaming","onSourceDialogClick","data","scrollToBottom","current","scrollTo","top","onChange","e","target","value","addChatMessage","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","sourceDocuments","newChatMessageBody","wrap","_callee$","_context","prev","next","role","content","JSON","stringify","createNewChatmessage","t0","console","error","stop","_x","_x2","_x3","apply","arguments","updateLastMessage","text","prevMessages","allMessages","_toConsumableArray","length","updateLastMessageSourceDocuments","handleError","undefined","replace","concat","setTimeout","_inputRef$current","focus","handleSubmit","_ref3","_callee2","params","response","errorData","_callee2$","_context2","preventDefault","trim","abrupt","question","history","filter","msg","sendMessageAndGetPrediction","sent","_inputRef$current2","status","statusText","_x4","handleEnter","isIMEComposition","isComposing","keyCode","key","shiftKey","loadedMessages","_iterator","_createForOfIteratorHelper","_step","s","n","done","obj","parse","push","err","f","_getIsChatflowStreami","_getIsChatflowStreami2","isStreaming","_inputRef$current3","socket","request","on","id","disconnect","children","className","ref","map","index","sx","background","palette","asyncSelect","main","style","display","isDarkMode","src","alt","width","height","flexDirection","remarkPlugins","rehypePlugins","components","code","_ref4","inline","props","_objectWithoutProperties","_excluded","match","exec","_objectSpread","language","String","Math","random","source","size","label","pageContent","substring","component","mr","mb","variant","clickable","onClick","onSubmit","autoFocus","disabled","onKeyDown","name","placeholder","multiline","maxRows","endAdornment","position","padding","edge","color","show","dialogProps","onCancel"],"sources":["/Users/zorro/Downloads/Flowise/packages/ui/src/views/chatmessage/ChatMessage.js"],"sourcesContent":["import { useState, useRef, useEffect, useCallback } from 'react'\nimport { useSelector } from 'react-redux'\nimport PropTypes from 'prop-types'\nimport socketIOClient from 'socket.io-client'\nimport { cloneDeep } from 'lodash'\nimport rehypeMathjax from 'rehype-mathjax'\nimport remarkGfm from 'remark-gfm'\nimport remarkMath from 'remark-math'\n\nimport { CircularProgress, OutlinedInput, Divider, InputAdornment, IconButton, Box, Chip } from '@mui/material'\nimport { useTheme } from '@mui/material/styles'\nimport { IconSend } from '@tabler/icons'\n\n// project import\nimport { CodeBlock } from 'ui-component/markdown/CodeBlock'\nimport { MemoizedReactMarkdown } from 'ui-component/markdown/MemoizedReactMarkdown'\nimport SourceDocDialog from 'ui-component/dialog/SourceDocDialog'\nimport './ChatMessage.css'\n\n// api\nimport chatmessageApi from 'api/chatmessage'\nimport chatflowsApi from 'api/chatflows'\nimport predictionApi from 'api/prediction'\n\n// Hooks\nimport useApi from 'hooks/useApi'\n\n// Const\nimport { baseURL, maxScroll } from 'store/constant'\n\nexport const ChatMessage = ({ open, chatflowid, isDialog }) => {\n    const theme = useTheme()\n    const customization = useSelector((state) => state.customization)\n\n    const ps = useRef()\n\n    const [userInput, setUserInput] = useState('')\n    const [loading, setLoading] = useState(false)\n    const [messages, setMessages] = useState([\n        {\n            message: 'Hi there! How can I help?',\n            type: 'apiMessage'\n        }\n    ])\n    const [socketIOClientId, setSocketIOClientId] = useState('')\n    const [isChatFlowAvailableToStream, setIsChatFlowAvailableToStream] = useState(false)\n    const [sourceDialogOpen, setSourceDialogOpen] = useState(false)\n    const [sourceDialogProps, setSourceDialogProps] = useState({})\n\n    const inputRef = useRef(null)\n    const getChatmessageApi = useApi(chatmessageApi.getChatmessageFromChatflow)\n    const getIsChatflowStreamingApi = useApi(chatflowsApi.getIsChatflowStreaming)\n\n    const onSourceDialogClick = (data) => {\n        setSourceDialogProps({ data })\n        setSourceDialogOpen(true)\n    }\n\n    const scrollToBottom = () => {\n        if (ps.current) {\n            ps.current.scrollTo({ top: maxScroll })\n        }\n    }\n\n    const onChange = useCallback((e) => setUserInput(e.target.value), [setUserInput])\n\n    const addChatMessage = async (message, type, sourceDocuments) => {\n        try {\n            const newChatMessageBody = {\n                role: type,\n                content: message,\n                chatflowid: chatflowid\n            }\n            if (sourceDocuments) newChatMessageBody.sourceDocuments = JSON.stringify(sourceDocuments)\n            await chatmessageApi.createNewChatmessage(chatflowid, newChatMessageBody)\n        } catch (error) {\n            console.error(error)\n        }\n    }\n\n    const updateLastMessage = (text) => {\n        setMessages((prevMessages) => {\n            let allMessages = [...cloneDeep(prevMessages)]\n            if (allMessages[allMessages.length - 1].type === 'userMessage') return allMessages\n            allMessages[allMessages.length - 1].message += text\n            return allMessages\n        })\n    }\n\n    const updateLastMessageSourceDocuments = (sourceDocuments) => {\n        setMessages((prevMessages) => {\n            let allMessages = [...cloneDeep(prevMessages)]\n            if (allMessages[allMessages.length - 1].type === 'userMessage') return allMessages\n            allMessages[allMessages.length - 1].sourceDocuments = sourceDocuments\n            return allMessages\n        })\n    }\n\n    // Handle errors\n    const handleError = (message = 'Oops! There seems to be an error. Please try again.') => {\n        message = message.replace(`Unable to parse JSON response from chat agent.\\n\\n`, '')\n        setMessages((prevMessages) => [...prevMessages, { message, type: 'apiMessage' }])\n        addChatMessage(message, 'apiMessage')\n        setLoading(false)\n        setUserInput('')\n        setTimeout(() => {\n            inputRef.current?.focus()\n        }, 100)\n    }\n\n    // Handle form submission\n    const handleSubmit = async (e) => {\n        e.preventDefault()\n\n        if (userInput.trim() === '') {\n            return\n        }\n\n        setLoading(true)\n        setMessages((prevMessages) => [...prevMessages, { message: userInput, type: 'userMessage' }])\n        // waiting for first chatmessage saved, the first chatmessage will be used in sendMessageAndGetPrediction\n        await addChatMessage(userInput, 'userMessage')\n\n        // Send user question and history to API\n        try {\n            const params = {\n                question: userInput,\n                history: messages.filter((msg) => msg.message !== 'Hi there! How can I help?')\n            }\n            if (isChatFlowAvailableToStream) params.socketIOClientId = socketIOClientId\n\n            const response = await predictionApi.sendMessageAndGetPrediction(chatflowid, params)\n\n            if (response.data) {\n                const data = response.data\n                if (typeof data === 'object' && data.text && data.sourceDocuments) {\n                    if (!isChatFlowAvailableToStream) {\n                        setMessages((prevMessages) => [\n                            ...prevMessages,\n                            { message: data.text, sourceDocuments: data.sourceDocuments, type: 'apiMessage' }\n                        ])\n                    }\n                    addChatMessage(data.text, 'apiMessage', data.sourceDocuments)\n                } else {\n                    if (!isChatFlowAvailableToStream) {\n                        setMessages((prevMessages) => [...prevMessages, { message: data, type: 'apiMessage' }])\n                    }\n                    addChatMessage(data, 'apiMessage')\n                }\n                setLoading(false)\n                setUserInput('')\n                setTimeout(() => {\n                    inputRef.current?.focus()\n                    scrollToBottom()\n                }, 100)\n            }\n        } catch (error) {\n            const errorData = error.response.data || `${error.response.status}: ${error.response.statusText}`\n            handleError(errorData)\n            return\n        }\n    }\n\n    // Prevent blank submissions and allow for multiline input\n    const handleEnter = (e) => {\n        // Check if IME composition is in progress\n        const isIMEComposition = e.isComposing || e.keyCode === 229\n        if (e.key === 'Enter' && userInput && !isIMEComposition) {\n            if (!e.shiftKey && userInput) {\n                handleSubmit(e)\n            }\n        } else if (e.key === 'Enter') {\n            e.preventDefault()\n        }\n    }\n\n    // Get chatmessages successful\n    useEffect(() => {\n        if (getChatmessageApi.data) {\n            const loadedMessages = []\n            for (const message of getChatmessageApi.data) {\n                const obj = {\n                    message: message.content,\n                    type: message.role\n                }\n                if (message.sourceDocuments) obj.sourceDocuments = JSON.parse(message.sourceDocuments)\n                loadedMessages.push(obj)\n            }\n            setMessages((prevMessages) => [...prevMessages, ...loadedMessages])\n        }\n\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [getChatmessageApi.data])\n\n    // Get chatflow streaming capability\n    useEffect(() => {\n        if (getIsChatflowStreamingApi.data) {\n            setIsChatFlowAvailableToStream(getIsChatflowStreamingApi.data?.isStreaming ?? false)\n        }\n\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [getIsChatflowStreamingApi.data])\n\n    // Auto scroll chat to bottom\n    useEffect(() => {\n        scrollToBottom()\n    }, [messages])\n\n    useEffect(() => {\n        if (isDialog && inputRef) {\n            setTimeout(() => {\n                inputRef.current?.focus()\n            }, 100)\n        }\n    }, [isDialog, inputRef])\n\n    useEffect(() => {\n        let socket\n        if (open && chatflowid) {\n            getChatmessageApi.request(chatflowid)\n            getIsChatflowStreamingApi.request(chatflowid)\n            scrollToBottom()\n\n            socket = socketIOClient(baseURL)\n\n            socket.on('connect', () => {\n                setSocketIOClientId(socket.id)\n            })\n\n            socket.on('start', () => {\n                setMessages((prevMessages) => [...prevMessages, { message: '', type: 'apiMessage' }])\n            })\n\n            socket.on('sourceDocuments', updateLastMessageSourceDocuments)\n\n            socket.on('token', updateLastMessage)\n        }\n\n        return () => {\n            setUserInput('')\n            setLoading(false)\n            setMessages([\n                {\n                    message: 'Hi there! How can I help?',\n                    type: 'apiMessage'\n                }\n            ])\n            if (socket) {\n                socket.disconnect()\n                setSocketIOClientId('')\n            }\n        }\n\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [open, chatflowid])\n\n    return (\n        <>\n            <div className={isDialog ? 'cloud-dialog' : 'cloud'}>\n                <div ref={ps} className='messagelist'>\n                    {messages &&\n                        messages.map((message, index) => {\n                            return (\n                                // The latest message sent by the user will be animated while waiting for a response\n                                <>\n                                    <Box\n                                        sx={{\n                                            background: message.type === 'apiMessage' ? theme.palette.asyncSelect.main : ''\n                                        }}\n                                        key={index}\n                                        style={{ display: 'flex' }}\n                                        className={\n                                            message.type === 'userMessage' && loading && index === messages.length - 1\n                                                ? customization.isDarkMode\n                                                    ? 'usermessagewaiting-dark'\n                                                    : 'usermessagewaiting-light'\n                                                : message.type === 'usermessagewaiting'\n                                                ? 'apimessage'\n                                                : 'usermessage'\n                                        }\n                                    >\n                                        {/* Display the correct icon depending on the message type */}\n                                        {message.type === 'apiMessage' ? (\n                                            <img\n                                                src='https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/parroticon.png'\n                                                alt='AI'\n                                                width='30'\n                                                height='30'\n                                                className='boticon'\n                                            />\n                                        ) : (\n                                            <img\n                                                src='https://raw.githubusercontent.com/zahidkhawaja/langchain-chat-nextjs/main/public/usericon.png'\n                                                alt='Me'\n                                                width='30'\n                                                height='30'\n                                                className='usericon'\n                                            />\n                                        )}\n                                        <div style={{ display: 'flex', flexDirection: 'column', width: '100%' }}>\n                                            <div className='markdownanswer'>\n                                                {/* Messages are being rendered in Markdown format */}\n                                                <MemoizedReactMarkdown\n                                                    remarkPlugins={[remarkGfm, remarkMath]}\n                                                    rehypePlugins={[rehypeMathjax]}\n                                                    components={{\n                                                        code({ inline, className, children, ...props }) {\n                                                            const match = /language-(\\w+)/.exec(className || '')\n                                                            return !inline ? (\n                                                                <CodeBlock\n                                                                    key={Math.random()}\n                                                                    chatflowid={chatflowid}\n                                                                    isDialog={isDialog}\n                                                                    language={(match && match[1]) || ''}\n                                                                    value={String(children).replace(/\\n$/, '')}\n                                                                    {...props}\n                                                                />\n                                                            ) : (\n                                                                <code className={className} {...props}>\n                                                                    {children}\n                                                                </code>\n                                                            )\n                                                        }\n                                                    }}\n                                                >\n                                                    {message.message}\n                                                </MemoizedReactMarkdown>\n                                            </div>\n                                            {message.sourceDocuments && (\n                                                <div style={{ display: 'block', flexDirection: 'row', width: '100%' }}>\n                                                    {message.sourceDocuments.map((source, index) => {\n                                                        return (\n                                                            <Chip\n                                                                size='small'\n                                                                key={index}\n                                                                label={`${source.pageContent.substring(0, 15)}...`}\n                                                                component='a'\n                                                                sx={{ mr: 1, mb: 1 }}\n                                                                variant='outlined'\n                                                                clickable\n                                                                onClick={() => onSourceDialogClick(source)}\n                                                            />\n                                                        )\n                                                    })}\n                                                </div>\n                                            )}\n                                        </div>\n                                    </Box>\n                                </>\n                            )\n                        })}\n                </div>\n            </div>\n            <Divider />\n            <div className='center'>\n                <div style={{ width: '100%' }}>\n                    <form style={{ width: '100%' }} onSubmit={handleSubmit}>\n                        <OutlinedInput\n                            inputRef={inputRef}\n                            // eslint-disable-next-line\n                            autoFocus\n                            sx={{ width: '100%' }}\n                            disabled={loading || !chatflowid}\n                            onKeyDown={handleEnter}\n                            id='userInput'\n                            name='userInput'\n                            placeholder={loading ? 'Waiting for response...' : 'Type your question...'}\n                            value={userInput}\n                            onChange={onChange}\n                            multiline={true}\n                            maxRows={isDialog ? 7 : 2}\n                            endAdornment={\n                                <InputAdornment position='end' sx={{ padding: '15px' }}>\n                                    <IconButton type='submit' disabled={loading || !chatflowid} edge='end'>\n                                        {loading ? (\n                                            <div>\n                                                <CircularProgress color='inherit' size={20} />\n                                            </div>\n                                        ) : (\n                                            // Send icon SVG in input field\n                                            <IconSend\n                                                color={loading || !chatflowid ? '#9e9e9e' : customization.isDarkMode ? 'white' : '#1e88e5'}\n                                            />\n                                        )}\n                                    </IconButton>\n                                </InputAdornment>\n                            }\n                        />\n                    </form>\n                </div>\n            </div>\n            <SourceDocDialog show={sourceDialogOpen} dialogProps={sourceDialogProps} onCancel={() => setSourceDialogOpen(false)} />\n        </>\n    )\n}\n\nChatMessage.propTypes = {\n    open: PropTypes.bool,\n    chatflowid: PropTypes.string,\n    isDialog: PropTypes.bool\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}